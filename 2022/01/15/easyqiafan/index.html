<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="别问，问就是恰饭脚本，统合了各种方法，整合成了一步式脚本，以后会持续在这里更新～">
<meta property="og:type" content="article">
<meta property="og:title" content="easyqiafan">
<meta property="og:url" content="https://biobrick.github.io/2022/01/15/easyqiafan/">
<meta property="og:site_name" content="Bio Harbor">
<meta property="og:description" content="别问，问就是恰饭脚本，统合了各种方法，整合成了一步式脚本，以后会持续在这里更新～">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-15T15:41:07.000Z">
<meta property="article:modified_time" content="2022-02-18T09:22:04.000Z">
<meta property="article:author" content="Chong Yin">
<meta name="twitter:card" content="summary"><title>easyqiafan | Bio Harbor</title><link ref="canonical" href="https://biobrick.github.io/2022/01/15/easyqiafan/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: true,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Bio Harbor</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">easyqiafan</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-15</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-18</span></span></div></header><div class="post-body">
        <h1 id="Update-2022-01-15">
          <a href="#Update-2022-01-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#Update-2022-01-15" class="headerlink" title="Update @2022-01-15"></a>Update @2022-01-15</h1>
      <p>为了极致偷懒，因此将关于TCGA分析的这些脚本统合在一起，TCGA数据本身非常规整，各种信息的列名这些都是固定的，因此实际上可以用固定的分析流程来做。主要是想减少复制粘贴代码，有些时候实在太麻烦了，改到最后都不知道改的是哪个脚本了。</p>
<p>这次更新聚类篇，使用ConsensusClusterPlus和NMF来进行一步式分析，直接得到分析结果和分组表，实际上非常简单就是了。</p>
<p>file:getClusterAll.R</p>
<figure class="highlight r"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">doconsensus &lt;- <span class="keyword">function</span>(exprset,genelist,maxk = <span class="number">10</span>)&#123;</span><br><span class="line">  library(ConsensusClusterPlus)</span><br><span class="line">  path = <span class="string">&quot;./consensusgroup/&quot;</span></span><br><span class="line">  method = <span class="string">&quot;pam&quot;</span></span><br><span class="line">  distance = <span class="string">&quot;pearson&quot;</span></span><br><span class="line">  dir.create(path)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#以防万一需要重构group_list</span></span><br><span class="line">  group_list &lt;- tinyarray::make_tcga_group(exprset)</span><br><span class="line">  index &lt;- which(group_list == <span class="string">&quot;tumor&quot;</span>)</span><br><span class="line">  cluster_exprset &lt;- exprset[,index]</span><br><span class="line"></span><br><span class="line">  cluster_exprset &lt;- cluster_exprset %&gt;% filter(.,row.names(.) %in% all_of(genelist))</span><br><span class="line">  write.csv(cluster_exprset,file = paste(path,<span class="string">&quot;cluster_exprset&quot;</span>,<span class="string">&quot;.csv&quot;</span>,sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">#做一下中心化</span></span><br><span class="line">  d = as.matrix(exprset)</span><br><span class="line">  d = sweep(d,<span class="number">1</span>, apply(d,<span class="number">1</span>,median))</span><br><span class="line"></span><br><span class="line">  res &lt;- ConsensusClusterPlus(d = d,</span><br><span class="line">                              maxK = maxk,</span><br><span class="line">                              pItem = <span class="number">0.8</span>,</span><br><span class="line">                              pFeature = <span class="number">1</span>,</span><br><span class="line">                              clusterAlg = method,</span><br><span class="line">                              title = paste(path,method,distance,sep = <span class="string">&quot;&quot;</span>),</span><br><span class="line">                              distance = distance,</span><br><span class="line">                              seed = <span class="number">20010320</span>,</span><br><span class="line">                              plot = <span class="string">&quot;pdf&quot;</span>,</span><br><span class="line">                              writeTable = <span class="literal">TRUE</span>,</span><br><span class="line">                              verbose = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span>(res)</span><br><span class="line">  detach(package:ConsensusClusterPlus)</span><br><span class="line"></span><br><span class="line">  lapply(<span class="number">2</span>:maxk, <span class="keyword">function</span>(x)&#123;</span><br><span class="line">    grouped &lt;- as.data.frame(res[[x]]$consensusClass)</span><br><span class="line">    <span class="built_in">names</span>(grouped) &lt;- <span class="string">&quot;subgroup&quot;</span></span><br><span class="line">    write.csv(pameucgrouped,file = paste(path,method,distance,x,<span class="string">&quot;.csv&quot;</span>,sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;ConsensusCluster Complete! Group file saved!&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">donmf &lt;- <span class="keyword">function</span>(exprset,genelist,maxk = <span class="number">10</span>)&#123;</span><br><span class="line">  path = <span class="string">&quot;./nmfgroups/&quot;</span></span><br><span class="line">  dir.create(path)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#以防万一需要重构group_list</span></span><br><span class="line">  group_list &lt;- tinyarray::make_tcga_group(exprset)</span><br><span class="line">  index &lt;- which(group_list == <span class="string">&quot;tumor&quot;</span>)</span><br><span class="line">  cluster_exprset &lt;- exprset[,index]</span><br><span class="line">  cluster_exprset &lt;- cluster_exprset %&gt;% filter(.,row.names(.) %in% all_of(genelist))</span><br><span class="line">  write.csv(cluster_exprset,file = paste(path,<span class="string">&quot;cluster_exprset&quot;</span>,<span class="string">&quot;.csv&quot;</span>,sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">max</span>(cluster_exprset)&gt;<span class="number">100</span>)&#123;cluster_exprset &lt;- log2(cluster_exprset + <span class="number">1</span>)&#125;</span><br><span class="line">  <span class="comment">#nmf用归一化，防止负数</span></span><br><span class="line">  normalize &lt;- <span class="keyword">function</span>(x)&#123;<span class="built_in">return</span>((x-<span class="built_in">min</span>(x))/(<span class="built_in">max</span>(x)-<span class="built_in">min</span>(x)))&#125;</span><br><span class="line">  cluster_exprset &lt;- normalize(cluster_exprset)</span><br><span class="line"></span><br><span class="line">  estimate &lt;- NMF::nmf(cluster_exprset,rank=<span class="number">2</span>:maxk,method=<span class="string">&quot;brunet&quot;</span>,nrun=<span class="number">10</span>,seed=<span class="number">20010320</span>)</span><br><span class="line"></span><br><span class="line">  pdf(<span class="string">&#x27;NMF-rank.pdf&#x27;</span>,width = <span class="number">12</span>,height = <span class="number">12</span>)</span><br><span class="line">  plot(estimate)</span><br><span class="line">  dev.off()</span><br><span class="line"></span><br><span class="line">  pdf(<span class="string">&#x27;nmfconsensusmap.pdf&#x27;</span>,width = <span class="number">20</span>,height = <span class="number">20</span>,onefile = <span class="built_in">T</span>)</span><br><span class="line">  NMF::consensusmap(estimate,annRow = <span class="literal">NA</span>,annCol = <span class="literal">NA</span>,main = <span class="string">&quot;Consensus matrix&quot;</span>,info = <span class="literal">FALSE</span>)</span><br><span class="line">  dev.off()</span><br><span class="line"></span><br><span class="line">  lapply(<span class="number">2</span>:maxk,<span class="keyword">function</span>(x)&#123;</span><br><span class="line">    estimate &lt;- NMF::nmf(cluster_exprset,rank = x,seed = <span class="number">20010320</span>,method = <span class="string">&quot;brunet&quot;</span>)</span><br><span class="line"></span><br><span class="line">    nmfgroup &lt;- predict(estimate)</span><br><span class="line">    nmfgroup &lt;- as.data.frame(nmfgroup)</span><br><span class="line">    nmfgroup$nmfgroup &lt;- paste0(<span class="string">&#x27;Cluster&#x27;</span>,nmfgroup$nmfgroup)</span><br><span class="line">    nmfgroup$sample &lt;- rownames(nmfgroup)</span><br><span class="line">    nmfgroup&lt;- nmfgroup[order(nmfgroup$nmfgroup),]</span><br><span class="line">    write.csv(nmfgroup,file = paste(path,x,<span class="string">&quot;groups&quot;</span>,<span class="string">&quot;csv&quot;</span>,sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;NMF Complete! Group file saved!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>这样只要输入TCGA/GTEx的表达矩阵，和感兴趣的基因列表，以及预期的聚类数，就能直接获得聚类的结果和全部分群的文件啦。而且还支持自定义方法类型，只需要自行修改想要的方法就行了。</p>

        <h1 id="Update-2022-01-19">
          <a href="#Update-2022-01-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#Update-2022-01-19" class="headerlink" title="Update @2022-01-19"></a>Update @2022-01-19</h1>
      <p>说好的第二更，此次更新关于差异分析，这是一个最最最常见的需求，无论是使用三大差异分析包(limma-voom，DESeq2，edgeR)还是大家手写统计学检验，都是一个非常常见的需求，这次更新DESeq2的整合分析方案，主要输出差异分析的最核心结果+图，包括PCA图，Enhance火山图和基因表达热图，差异分析结果表格以及分组表。DESeq2要求输入为count，而且得是整数和非负，将一些预处理整合进去了。</p>
<p>由于一些显而易见的原因，这个脚本只支持TCGA和GTEx的分析，倒不是GEO和自定义数据没有脚本，纯粹是我懒得更新那个版本。</p>
<p>分析中使用了tinyarray的一些函数功能，特此感谢～，希望大家都去github上star一下这个包，很好用。</p>
<p>顺便我发现stun的hexo主题居然不支持默认数学公式….统计检验里的数学公式写了个寂寞…找时间我研究一下。</p>
<figure class="highlight r"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#x27; 将DESeq2差异分析收归至一个函数中，改为类似cibersort一样的用法</span></span><br><span class="line"><span class="comment">#&#x27; 这样的话只需要输入处理好的表达矩阵和metadata就能够直接得到PCA图+DEG结果+火山图+想看的基因的热图</span></span><br><span class="line"><span class="comment">#&#x27; 写法也参考了cibersort的脚本，目前只整合了DESeq2的方法，后续找时间整合edgeR和limma</span></span><br><span class="line"><span class="comment">#&#x27; 很多函数借用了tinyarray，特此感谢！(tinyarray:https://github.com/xjsun1221/tinyarray)</span></span><br><span class="line"><span class="comment">#&#x27; <span class="doctag">@Author</span>：韩重印</span></span><br><span class="line"><span class="comment">#&#x27; <span class="doctag">@param <span class="variable">exprset</span></span> 表达矩阵，data.frame,样式必须是基因为行名，样本为列名，而且应当提前去掉NA</span></span><br><span class="line"><span class="comment">#&#x27; <span class="doctag">@param <span class="variable">metadata</span></span> data.frame,样式必须为行名为样本名（暂时不需要）</span></span><br><span class="line"><span class="comment">#&#x27; <span class="doctag">@param <span class="variable">genelist</span></span> 准备在火山图和热图中展示的基因列表，一行vector即可</span></span><br><span class="line"><span class="comment">#&#x27; <span class="doctag">@param <span class="variable">degtype</span></span> 准备使用的差异方法，参数为deseq2,limma和edger，注意适用范围</span></span><br><span class="line"></span><br><span class="line">getDEGs &lt;- <span class="keyword">function</span>(exprset,genelist,degtype = <span class="string">&quot;deseq2&quot;</span>)&#123;</span><br><span class="line">  <span class="comment">#No check packages</span></span><br><span class="line">  library(tidyverse)</span><br><span class="line">  library(tinyarray)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!(degtype %in% <span class="built_in">c</span>(<span class="string">&quot;deseq2&quot;</span>,<span class="string">&quot;limma&quot;</span>,<span class="string">&quot;dger&quot;</span>)))&#123;</span><br><span class="line">    stop(<span class="string">&quot;请输入正确的差异分析方法&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#如果出现负数，得处理掉</span></span><br><span class="line">  exprset[exprset&lt;<span class="number">0</span>] &lt;- <span class="literal">NA</span></span><br><span class="line">  exprset &lt;- na.omit(exprset)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#创建group_list</span></span><br><span class="line">  group_list &lt;- tinyarray::make_tcga_group(exprset)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#PCA画图要在反log之前画，因为PCA需要标准化的数据，反log之后差异太大了</span></span><br><span class="line">  <span class="comment">#pca plot</span></span><br><span class="line">  pca.plot &lt;- draw_pca(exprset,group_list)</span><br><span class="line">  pca.plot &lt;- pca.plot + theme_classic()</span><br><span class="line">  Cairo::CairoPDF(file = <span class="string">&quot;pcaplot.pdf&quot;</span>,width = <span class="number">10</span>,height = <span class="number">10</span>)</span><br><span class="line">  print(pca.plot)</span><br><span class="line">  dev.off()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">max</span>(exprset)&lt;<span class="number">50</span>)&#123;exprset &lt;- <span class="built_in">ceiling</span>(<span class="number">2</span>^exprset - <span class="number">1</span>)&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#过滤掉表达量较低的基因，以25% 0值为阈值，这在bulk已经是一个比较严格的标准了。</span></span><br><span class="line">  valid_gene &lt;- apply(exprset,<span class="number">1</span>, <span class="keyword">function</span>(x)&#123;<span class="built_in">sum</span>(x==<span class="number">0</span>) &lt;= <span class="number">0.25</span>*ncol(exprset)&#125;)</span><br><span class="line">  exprset &lt;- exprset[valid_gene,]</span><br><span class="line"></span><br><span class="line">  colData &lt;- data.frame(row.names = colnames(exprset),condition = group_list)</span><br><span class="line">  valid_genes &lt;- dplyr::intersect(genelist,row.names(exprset))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!<span class="built_in">length</span>(valid_genes))&#123;stop(<span class="string">&quot;你的基因在表达矩阵里全都不存在&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(degtype==<span class="string">&quot;deseq2&quot;</span>)&#123;</span><br><span class="line">  <span class="comment">#使用DESeq2</span></span><br><span class="line"></span><br><span class="line">  library(DESeq2)</span><br><span class="line">  dds &lt;- DESeqDataSetFromMatrix(</span><br><span class="line">    countData = exprset,</span><br><span class="line">    colData = colData,</span><br><span class="line">    design = ~condition)</span><br><span class="line"></span><br><span class="line">  dds &lt;- DESeq(dds)</span><br><span class="line">  res &lt;- results(dds, contrast = <span class="built_in">c</span>(<span class="string">&quot;condition&quot;</span>,rev(levels(group_list))))</span><br><span class="line">  resOrdered &lt;- res[order(res$pvalue),]</span><br><span class="line">  DEG &lt;- as.data.frame(resOrdered)</span><br><span class="line">  DEG &lt;- na.omit(DEG)</span><br><span class="line"></span><br><span class="line">  detach(package:DESeq2)</span><br><span class="line"></span><br><span class="line">  logFC_cutoff &lt;- 2</span><br><span class="line"></span><br><span class="line">  DEG$change = as.factor(</span><br><span class="line">    ifelse(DEG$pvalue &lt; <span class="number">0.05</span> &amp; <span class="built_in">abs</span>(DEG$log2FoldChange) &gt; logFC_cutoff,</span><br><span class="line">           ifelse(DEG$log2FoldChange &gt; logFC_cutoff ,<span class="string">&#x27;UP&#x27;</span>,<span class="string">&#x27;DOWN&#x27;</span>),<span class="string">&#x27;NOT&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  genelist_up &lt;- DEG %&gt;% filter(.,change == <span class="string">&quot;UP&quot;</span>) %&gt;% filter(.,rownames(.) %in% all_of(genelist))</span><br><span class="line">  genelist_down &lt;- DEG %&gt;% filter(.,change == <span class="string">&quot;DOWN&quot;</span>) %&gt;% filter(.,rownames(.) %in% all_of(genelist))</span><br><span class="line"></span><br><span class="line">  print(paste((<span class="string">&quot;总上调表达基因有&quot;</span>),nrow(DEG[DEG$change==<span class="string">&quot;UP&quot;</span>,]),sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line">  print(paste((<span class="string">&quot;总下调表达基因有&quot;</span>),nrow(DEG[DEG$change ==<span class="string">&quot;DOWN&quot;</span>,]),sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line">  print(paste((<span class="string">&quot;上调表达的重要基因有&quot;</span>),nrow(genelist_up),sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line">  print(paste((<span class="string">&quot;下调表达的重要基因有&quot;</span>),nrow(genelist_down),sep = <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">#数据持久化出来，顺便画几张图</span></span><br><span class="line">  write.csv(DEG,<span class="string">&quot;DESeq2_DEG.csv&quot;</span>)</span><br><span class="line">  write.csv(group_list,<span class="string">&quot;group_list.csv&quot;</span>)</span><br><span class="line">  write.csv(colData,<span class="string">&quot;colData.csv&quot;</span>)</span><br><span class="line">  write.csv(genelist_up,<span class="string">&quot;genelist_up.csv&quot;</span>)</span><br><span class="line">  write.csv(genelist_down,<span class="string">&quot;genelist_down.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#高级火山图</span></span><br><span class="line">  library(EnhancedVolcano)</span><br><span class="line">  E1 &lt;- EnhancedVolcano(DEG, </span><br><span class="line">                        lab = row.names(DEG),</span><br><span class="line">                        selectLab = genelist,</span><br><span class="line">                        x = <span class="string">&#x27;log2FoldChange&#x27;</span>,</span><br><span class="line">                        xlab = bquote(~Log[<span class="number">2</span>]~ <span class="string">&#x27;Fold Change&#x27;</span>),</span><br><span class="line">                        y = <span class="string">&#x27;padj&#x27;</span>, </span><br><span class="line">                        <span class="comment">#ylim = c(0,10),</span></span><br><span class="line">                        title = <span class="string">&#x27;Tumor versus Normal&#x27;</span>,</span><br><span class="line">                        pCutoff = <span class="number">10e-2</span>,</span><br><span class="line">                        FCcutoff = <span class="number">2</span>, </span><br><span class="line">                        pointSize = <span class="number">2.0</span>, </span><br><span class="line">                        labSize = <span class="number">2.0</span>,</span><br><span class="line">                        legendPosition = <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">                        legendLabSize = <span class="number">12</span>,</span><br><span class="line">                        drawConnectors = <span class="literal">TRUE</span>, </span><br><span class="line">                        widthConnectors = <span class="number">0.5</span>, </span><br><span class="line">                        col = <span class="built_in">c</span>(<span class="string">&#x27;grey&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;darkgreen&#x27;</span>, <span class="string">&#x27;red&#x27;</span>), </span><br><span class="line">                        colAlpha = <span class="number">0.5</span>,</span><br><span class="line">                        colConnectors = <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  Cairo::CairoPDF(file = <span class="string">&quot;DEGVolcano.pdf&quot;</span>,width = <span class="number">10</span>,height = <span class="number">10</span>)</span><br><span class="line">  print(E1)</span><br><span class="line">  dev.off()</span><br><span class="line">  detach(package:EnhancedVolcano)</span><br><span class="line"></span><br><span class="line">  <span class="comment">#指定基因的heatmap</span></span><br><span class="line">  colData &lt;- colData %&gt;% </span><br><span class="line">    mutate(colData,id = row.names(colData)) %&gt;%</span><br><span class="line">    arrange(colData,desc(condition))</span><br><span class="line"></span><br><span class="line">  dat &lt;- exprset %&gt;% select(.,all_of(colData$id),everything())</span><br><span class="line">  dat_group_list &lt;- colData$condition</span><br><span class="line"></span><br><span class="line">  <span class="comment">#取差异表达的核心基因</span></span><br><span class="line">  cg1 &lt;- rownames(DEG)[DEG$change !=<span class="string">&quot;NOT&quot;</span>]</span><br><span class="line">  cg1 &lt;- dplyr::intersect(cg1,genelist)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">length</span>(cg1)==<span class="number">0</span>)&#123;</span><br><span class="line">    print(<span class="string">&quot;你的基因列表里没有差异表达基因，但还是给你画个热图。&quot;</span>)</span><br><span class="line">    h1 = draw_heatmap(dat[genelist,],</span><br><span class="line">                      dat_group_list,</span><br><span class="line">                      cluster_cols = <span class="literal">FALSE</span>,</span><br><span class="line">                      legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      show_rownames = <span class="literal">TRUE</span>,</span><br><span class="line">                      split_column = <span class="literal">FALSE</span>,</span><br><span class="line">                      annotation_legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      n_cutoff = <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    Cairo::CairoPDF(file = <span class="string">&quot;DEGHeatmap.pdf&quot;</span>,width = <span class="number">10</span>,height = <span class="number">10</span>)</span><br><span class="line">    print(h1)</span><br><span class="line">    dev.off()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">length</span>(cg1)&gt;<span class="number">10</span>)&#123;</span><br><span class="line">    cg1 &lt;- cg1[<span class="number">1</span>:<span class="number">10</span>]</span><br><span class="line">    h1 = draw_heatmap(dat[cg1,],</span><br><span class="line">                      dat_group_list,</span><br><span class="line">                      cluster_cols = <span class="literal">FALSE</span>,</span><br><span class="line">                      legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      show_rownames = <span class="literal">TRUE</span>,</span><br><span class="line">                      split_column = <span class="literal">FALSE</span>,</span><br><span class="line">                      annotation_legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      n_cutoff = <span class="number">2</span>)</span><br><span class="line">    Cairo::CairoPDF(file = <span class="string">&quot;DEGHeatmap.pdf&quot;</span>,width = <span class="number">10</span>,height = <span class="number">10</span>)</span><br><span class="line">    print(h1)</span><br><span class="line">    dev.off()</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    h1 = draw_heatmap(dat[cg1,],</span><br><span class="line">                      dat_group_list,</span><br><span class="line">                      cluster_cols = <span class="literal">FALSE</span>,</span><br><span class="line">                      legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      show_rownames = <span class="literal">TRUE</span>,</span><br><span class="line">                      split_column = <span class="literal">FALSE</span>,</span><br><span class="line">                      annotation_legend = <span class="literal">TRUE</span>,</span><br><span class="line">                      n_cutoff = <span class="number">2</span>)</span><br><span class="line">    Cairo::CairoPDF(file = <span class="string">&quot;DEGHeatmap.pdf&quot;</span>,width = <span class="number">10</span>,height = <span class="number">10</span>)</span><br><span class="line">    print(h1)</span><br><span class="line">    dev.off()</span><br><span class="line">  &#125;</span><br><span class="line">  TNcolData &lt;- colData</span><br><span class="line">  <span class="built_in">return</span>(TNcolData)</span><br><span class="line"></span><br><span class="line">  print(<span class="string">&quot;File Saved. Unnecessary Packages detached. Proceed To Next Step.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>只需要把这个函数写写进.R文件里，然后source就行了，函数输入需要表达矩阵，和一个你准备研究的基因列表，如果不输入基因列表，可以自行去函数里加一个取差异表的排名靠前的基因就行，这里自己写就行了，顺便，你tm连感兴趣的群集都没有还研究个屁。</p>
<p>顺便为啥不用<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/stemangiola/tidybulk">tidybulk</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>？这个框架比较久之前我就看过了，但是跟技能树健明大佬说的一样，这个包其一对DESeq2的支持不佳，其二太多写死的参数。其三，我认为这个包本身是违反tidyverse精神的，形象地说，tidyverse本身就是只给了螺丝，铁块，而工具需要自己组，但是tidybulk的做法本质上和这种脚本化没区别，反正都是写死的，那为啥不直接自己写tidy的分析流程就行了（比如我的这个脚本也有tidy版本的），非要用一个封装得这么死的框架。所以我觉得称其为tidy-like-bulk更好就是了。尽管如此，这个包的工作结果当然很优秀，也有可借鉴性，比如它对数据的一些预处理和检验的部分，很值得我吸收，后面会考虑将部分数据检查的流程加进去～</p>
<p>下一次更新什么呢？</p>
<p><del>更新一个简单好用的森林图绘制？</del></p>
<p><del>还是更新一下全数据获取和预处理？</del></p>
<p>算了，开摆！</p>

        <h1 id="Update-2022-02-18">
          <a href="#Update-2022-02-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#Update-2022-02-18" class="headerlink" title="Update @2022-02-18"></a>Update @2022-02-18</h1>
      <p>更新一波：关于如何构建基线表并做基本统计分析。以便迅速找到值得研究的临床特征，使用tableone构建临床样本的基线表+统计信息，提供自定的变量选择与统计分析。</p>
<figure class="highlight r"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用STAD的临床特征数据</span></span><br><span class="line">library(UCSCXenaTools)</span><br><span class="line">library(tidyverse)</span><br><span class="line">library(tableone)</span><br><span class="line"></span><br><span class="line">survset&lt;-XenaGenerate(subset = XenaCohorts == <span class="string">&quot;GDC TCGA Stomach Cancer (STAD)&quot;</span>) %&gt;% </span><br><span class="line">    XenaFilter(filterDatasets = <span class="string">&quot;TCGA-STAD.survival.tsv&quot;</span>) %&gt;% </span><br><span class="line">    XenaQuery() %&gt;%</span><br><span class="line">    XenaDownload() %&gt;% </span><br><span class="line">    XenaPrepare() </span><br><span class="line"></span><br><span class="line">metaset&lt;-XenaGenerate(subset = XenaCohorts == <span class="string">&quot;GDC TCGA Stomach Cancer (STAD)&quot;</span>) %&gt;% </span><br><span class="line">    XenaFilter(filterDatasets = <span class="string">&quot;TCGA-STAD.GDC_phenotype.tsv&quot;</span>) %&gt;% </span><br><span class="line">    XenaQuery() %&gt;%</span><br><span class="line">    XenaDownload() %&gt;% </span><br><span class="line">    XenaPrepare() </span><br><span class="line"></span><br><span class="line">survset &lt;- as.data.frame(survset)</span><br><span class="line">metaset &lt;- as.data.frame(metaset)</span><br><span class="line"></span><br><span class="line"><span class="built_in">names</span>(metaset)[<span class="number">1</span>] &lt;- <span class="string">&quot;sample&quot;</span></span><br><span class="line"></span><br><span class="line">metaset &lt;- metaset %&gt;% left_join(.,survset,by = <span class="string">&quot;sample&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">#理论上实际上这样就可以直接做表，但是应该进行一下筛选，按照低比例筛选留下来的特征 </span></span><br><span class="line"></span><br><span class="line">delnabyratiol &lt;- <span class="keyword">function</span>(df,ratiol = <span class="number">0.1</span>)&#123;</span><br><span class="line"> index &lt;- apply(df,<span class="number">2</span>,<span class="keyword">function</span>(x)&#123;ifelse(<span class="built_in">sum</span>(<span class="built_in">is.na</span>(x))&gt;ratiol*<span class="built_in">length</span>(x),<span class="literal">FALSE</span>,<span class="literal">TRUE</span>)&#125;)</span><br><span class="line"> tmp &lt;- df[,index]</span><br><span class="line"> clean &lt;- tmp[which(complete.cases(tmp)),]</span><br><span class="line"> <span class="built_in">return</span>(clean)</span><br><span class="line">&#125;</span><br><span class="line">cleanmeta = delnabyratiol(metaset,ratiol = <span class="number">0.1</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">#TCGA的meta都是一致的，因此可以共同筛选,如果需要自定义的话要在这里改动。</span></span><br><span class="line">selectmeta &lt;- <span class="built_in">c</span>(<span class="string">&quot;sample&quot;</span>,<span class="string">&quot;age_at_initial_pathologic_diagnosis&quot;</span>,</span><br><span class="line"> <span class="string">&quot;neoplasm_histologic_grade&quot;</span>,<span class="string">&quot;pathologic_M&quot;</span>,<span class="string">&quot;pathologic_N&quot;</span>,<span class="string">&quot;pathologic_T&quot;</span>,<span class="string">&quot;gender.demographic&quot;</span>,</span><br><span class="line"> <span class="string">&quot;tumor_stage.diagnoses&quot;</span>,<span class="string">&quot;sample_type.samples&quot;</span>,<span class="string">&quot;OS&quot;</span>,<span class="string">&quot;OS.time&quot;</span>)</span><br><span class="line">metadata &lt;- cleanmeta %&gt;% select(.,all_of(selectmeta))</span><br><span class="line"></span><br><span class="line"><span class="built_in">names</span>(metadata) &lt;- <span class="built_in">c</span>(<span class="string">&quot;sample&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;neoplasm_histologic_grade&quot;</span>,<span class="string">&quot;M&quot;</span>,<span class="string">&quot;N&quot;</span>,<span class="string">&quot;T&quot;</span>,<span class="string">&quot;gender&quot;</span>,</span><br><span class="line"> <span class="string">&quot;tumor_stage&quot;</span>,<span class="string">&quot;sample_type&quot;</span>,<span class="string">&quot;OS&quot;</span>,<span class="string">&quot;OS.time&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果有必要需要设置单独的因子型变量，比如数值变量和因子变量混合的时候。</span></span><br><span class="line">allVars &lt;- <span class="built_in">names</span>(metadata)[<span class="built_in">c</span>(-<span class="number">1</span>,-<span class="number">9</span>)]</span><br><span class="line">catVars &lt;- <span class="built_in">c</span>(<span class="string">&quot;neoplasm_histologic_grade&quot;</span>,<span class="string">&quot;M&quot;</span>,<span class="string">&quot;N&quot;</span>,<span class="string">&quot;T&quot;</span>,<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;tumor_stage&quot;</span>,<span class="string">&quot;OS&quot;</span>) </span><br><span class="line">getclintable &lt;- </span><br><span class="line"></span><br><span class="line">tab &lt;- CreateTableOne(vars = allVars,</span><br><span class="line"> strata = <span class="string">&quot;sample_type&quot;</span>,</span><br><span class="line"> data = metadata,</span><br><span class="line"> factorVars = catVars)</span><br><span class="line">print(tab,formatOptions = <span class="built_in">list</span>(big.mark = <span class="string">&quot;,&quot;</span>))</span><br><span class="line">tab2csv &lt;- print(tab, <span class="built_in">quote</span> = <span class="literal">FALSE</span>, noSpaces = <span class="literal">TRUE</span>, printToggle = <span class="literal">FALSE</span>)</span><br><span class="line">write.csv(tab2csv, file = <span class="string">&quot;metadata_statics.csv&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">#但有时候只想进行描述性统计：</span></span><br><span class="line">tab2 &lt;- CreateTableOne(vars = allVars, data = metadata, factorVars = catVars)</span><br><span class="line">print(tab2,formatOptions = <span class="built_in">list</span>(big.mark = <span class="string">&quot;,&quot;</span>)) </span><br><span class="line">tab22csv &lt;- print(tab2, <span class="built_in">quote</span> = <span class="literal">FALSE</span>, noSpaces = <span class="literal">TRUE</span>, printToggle = <span class="literal">FALSE</span>)</span><br><span class="line">write.csv(tab22csv, file = <span class="string">&quot;metadata_desc.csv&quot;</span>)</span><br></pre></td></tr></table></div></figure>
<p>原本还打算用 MOVICS的compClinvar来尝试一下，结果贼不好用，目前看来MOVICS对于moic.res这个对象耦合太严重了，如果想调用的话每次都得重新构建这个对象，虽然听上去很理想，一开始就构建一个对象，但是实际操作起来很难搞。</p>
<p>下一次更新从UCSCXenaTools下载数据并组合成moic.res对象，这样方便用MOVICS里面的工具，而且也算是一种简单的数据管理的方式。</p>
<p>另外，Rdata的数据密度比csv大多了，建议以后存储数据都用专门的数据存储格式，少存csv。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://biobrick.github.io">Chong Yin</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://biobrick.github.io/2022/01/15/easyqiafan/">https://biobrick.github.io/2022/01/15/easyqiafan/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-reward reward"><div class="reward-button">请我喝杯咖啡~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="/images/alipay.png"><div class="reward-qrcode-alipay__text">支付宝打赏</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="/images/wechatpay.png"><div class="reward-qrcode-wechat__text">微信打赏</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/01/25/%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8B%E5%87%BD%E6%95%B0%E5%8C%85%E8%A3%85/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">小技巧之函数包装</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2021/12/31/%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/"><span class="paginator-prev__text">新年快乐</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Update-2022-01-15"><span class="toc-number">1.</span> <span class="toc-text">
          Update @2022-01-15</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Update-2022-01-19"><span class="toc-number">2.</span> <span class="toc-text">
          Update @2022-01-19</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Update-2022-02-18"><span class="toc-number">3.</span> <span class="toc-text">
          Update @2022-02-18</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/BIOBRICK/" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="386396663" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">17</div><div class="sidebar-ov-state-item__name">归档</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Chong Yin</span></div><div><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>